language: C

os:
  - linux

cache:
  - apt
  - pip

env:
  global:
    - VER_NGINX=1.9.11
    - COV=1

compiler:
  - clang
  - gcc

before_script:
  - apt-get install build-essential bzip2 libpcre3-dev libssl-dev daemon libgeoip-dev unzip cpanminus


install:
  - wget "http://nginx.org/download/nginx-${VER_NGINX}.tar.gz" && tar -xf "nginx-${VER_NGINX}.tar.gz"
  - cd nginx-${VER_NGINX}
  - ./configure --conf-path=/etc/nginx/nginx.conf --add-module=../naxsi_src/  --error-log-path=/var/log/nginx/error.log --http-client-body-temp-path=/var/lib/nginx/body  --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-log-path=/var/log/nginx/access.log  --http-proxy-temp-path=/var/lib/nginx/proxy --lock-path=/var/lock/nginx.lock  --pid-path=/var/run/nginx.pid --with-http_ssl_module --without-mail_pop3_module --without-mail_smtp_module  --without-mail_imap_module --without-http_uwsgi_module  --without-http_scgi_module --with-ipv6 --prefix=/usr --with-http_realip_module

script: make 

after_failure: 
 - cat ../t/servroot/logs/error.log
 - cat /tmp/ngx_error.log
 - cat /tmp/ngx_access.log

after_success:
 - lcov --list naxsi.info
 - coveralls-lcov --repo-token ${COVERALLS_TOKEN} naxsi.info
